var debug=function(){var a=!1;return{enable:function(){a=!0},log:function(c){a&&console.log(c)}}}(),Query=function(){return{hash:function(){for(var a=window.location.hash.substr(1).split("&"),c={},b=0;b<a.length;b++){var d=a[b].split("=");c[d[0]]=d[1]}return c}}}(),Foursquare=function(){var a=window.location.href.substr(0,window.location.href.length-window.location.hash.length),c=null;return{isAuthenticated:function(){return this.authenticationToken()?!0:!1},authenticationToken:function(){c||(c=Query.hash().access_token);
return c},authenticate:function(b){this.isAuthenticated()?(debug.log("foursquare: authenticated"),b&&b()):(b="https://foursquare.com/oauth2/authenticate?client_id=VPTKPWBYJHIWMMELN2KWWSTSEKD4HED5UR1MZSN5XOULAXNE&response_type=token&redirect_uri="+encodeURIComponent(a),debug.log("foursquare: authenticate redirect"),window.location=b)},explore:function(b,c){debug.log("foursquare: explore called");var a={v:"21130601"},e=this.authenticationToken();e?a.oauth_token=e:(a.client_id="VPTKPWBYJHIWMMELN2KWWSTSEKD4HED5UR1MZSN5XOULAXNE",
a.client_secret="UNTLVJCNLZL1SBUY03LBOFKMOTQ2EGO3OMLQX5KEUS0R1QG0");a=$.ajax({url:"https://api.foursquare.com/v2/venues/explore",data:$.extend(a,b)});a.done(function(a){debug.log("foursquare: explore result obtained");a=a.response.groups;a=$.map(a.length?a[0].items:null,function(a){return a.venue});c(a)});a.fail(function(){debug.log("foursquare: explore error");c(null)})}}}(),Application=function(){return{run:function(){debug.enable();debug.log("application: ready");var a=$("<div></div>");a.addClass("loading");
a.append("Searching for a sweet lunch joint. Please hang in there for just a second.");var c=$("#notifications");c.empty();c.append(a);Foursquare.authenticate(function(){debug.log("application: authenticated");Application._obtainUserPosition()})},_obtainUserPosition:function(){navigator.geolocation.getCurrentPosition(Application._positionObtained,Application._positionError,{maximumAge:9E4})},_positionObtained:function(a){debug.log("application: position obtained");Foursquare.explore({ll:a.coords.latitude+
","+a.coords.longitude,llAcc:a.coords.accuracy,section:"food",time:"12:00"},function(a){debug.log("application: explore result obtained");var b=Math.floor(Math.random()*a.length);(a=a[b])?Application._showVenue(a):(a=$("<div></div>"),a.addClass("nowhere"),a.append("We couldn't find anywhere for you to go. :("),b=$("#notifications"),b.empty(),b.append(a))})},_positionError:function(a){debug.log("application: position error")},_showVenue:function(a){var c=$("<div></div>"),b=$("<p></p>");b.append(a.name);
c.append(b);a.location.address&&(b=$("<p></p>"),b.addClass("address"),b.append(a.location.address),c.append(b));a.location.crossStreet&&(b=$("<p></p>"),b.addClass("crossStreet"),b.append(a.location.crossStreet),c.append(b));var b=$("#notifications"),d=$("#location");d.empty();d.append(c);d.append($('<div id="map_canvas"></div>'));b.fadeOut("slow",function(){d.fadeIn("slow",function(){Application._showMap(a)})})},_showMap:function(a){var c=new google.maps.LatLng(a.location.lat,a.location.lng),b=new google.maps.Map(document.getElementById("map_canvas"),
{center:c,disableDefaultUI:!0,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL},zoom:17,scrollwheel:!1,mapTypeId:google.maps.MapTypeId.ROADMAP});new google.maps.Marker({position:c,map:b,title:a.name})}}}();$(document).ready(function(){Application.run()});
